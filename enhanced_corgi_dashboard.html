<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ¯åŸºå­¦ä¹ å°åŠ©æ‰‹ - å¢å¼ºç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#32C77F",
                        warning: "#FF9B27", 
                        danger: "#ED4B4B",
                        "text-dark-brown": "#715D46",
                        "text-medium-brown": "#9B8D7D",
                        "text-gray": "#828282",
                        "bg-light-blue-gray": "#F5F7F9",
                        "bg-light-green": "#E2F2EB",
                        "bg-light-gray": "#F2F0ED",
                    }
                }
            }
        };
    </script>
    <style>
        /* ç¦ç”¨å…¨å±€æ–‡æœ¬é€‰æ‹© */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hover-scale:hover { transform: scale(1.02); transition: transform 0.2s ease; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .card-shadow:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); transition: box-shadow 0.3s ease; }
        
        /* æ‹–æ‹½åŒºåŸŸ */
        .drag-area {
            cursor: move;
        }
        
        /* çª—å£æ§åˆ¶æŒ‰é’® */
        .window-control {
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="bg-bg-light-blue-gray font-sans">
    <div class="flex h-screen bg-white">
        <!-- ä¾§è¾¹æ  -->
        <aside class="w-64 flex flex-col p-4 bg-white border-r border-gray-200">
            <div class="flex items-center mb-8">
                <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center mr-3">
                    <span class="text-white text-xl">ğŸ•</span>
                </div>
                <h1 class="text-lg font-bold text-text-dark-brown">æŸ¯åŸºå­¦ä¹ å°åŠ©æ‰‹</h1>
            </div>
            
            <div class="flex flex-col items-center mb-8">
                <div class="w-20 h-20 rounded-full mb-2 bg-bg-light-green flex items-center justify-center">
                    <span class="text-3xl text-primary">ğŸ‘¤</span>
                </div>
                <p class="font-semibold text-text-dark-brown">æŸ¯åŸºçš„ä¸»äºº</p>
                <p class="text-sm text-text-medium-brown">å­¦ä¹ ç­‰çº§: Lv.5 â­</p>
            </div>
            
            <nav class="flex-1 space-y-2" id="navigation">
                <!-- å¯¼èˆªé¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </nav>
        </aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 p-8 bg-bg-light-blue-gray overflow-y-auto">
            <header class="flex justify-between items-center mb-8 fade-in">
                <div class="flex items-center drag-area" onmousedown="startWindowDrag(event)">
                    <div class="w-12 h-12 mr-4 bg-bg-light-green rounded-full flex items-center justify-center">
                        <span class="text-2xl text-primary">ğŸ•</span>
                    </div>
                    <h2 class="text-3xl font-bold text-text-dark-brown">æŸ¯åŸºçš„å­¦ä¹ ä¹å›­</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right drag-area" onmousedown="startWindowDrag(event)">
                        <p class="font-semibold text-text-dark-brown">â˜€ï¸ æ±ªæ±ªï¼æ¬¢è¿å›æ¥ï¼</p>
                        <p class="text-sm text-text-gray" id="currentDate"></p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="window-control w-8 h-8 bg-gray-300 hover:bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-bold transition-colors duration-200" onclick="callPythonFunction('minimizeWindow')" title="æœ€å°åŒ–">
                            âˆ’
                        </button>
                        <button class="window-control w-8 h-8 bg-warning hover:bg-yellow-500 rounded-full flex items-center justify-center text-white text-sm font-bold transition-colors duration-200" onclick="callPythonFunction('maximizeWindow')" title="æœ€å¤§åŒ–/è¿˜åŸ">
                            â–¡
                        </button>
                        <button class="window-control w-8 h-8 bg-danger hover:bg-red-600 rounded-full flex items-center justify-center text-white text-sm font-bold transition-colors duration-200" onclick="callPythonFunction('closeWindow')" title="å…³é—­">
                            Ã—
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-4 gap-6 mb-8" id="statsCards">
                <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- å¿«é€Ÿæ“ä½œ -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-text-dark-brown mb-4">å¿«é€Ÿæ“ä½œ</h3>
                <div class="grid grid-cols-4 gap-6">
                    <button class="bg-primary hover:bg-green-600 text-white font-semibold py-4 rounded-xl flex flex-col items-center justify-center transition duration-300 card-shadow hover-scale" onclick="callPythonFunction('createNote')">
                        <span class="text-2xl mb-2">â•</span>
                        <span>æ–°å»ºç¬”è®°</span>
                    </button>
                    <button class="bg-red-400 hover:bg-red-500 text-white font-semibold py-4 rounded-xl flex flex-col items-center justify-center transition duration-300 card-shadow hover-scale" onclick="callPythonFunction('startRecording')">
                        <span class="text-2xl mb-2">ğŸ™ï¸</span>
                        <span>å¼€å§‹å½•åˆ¶</span>
                    </button>
                    <button class="bg-orange-400 hover:bg-orange-500 text-white font-semibold py-4 rounded-xl flex flex-col items-center justify-center transition duration-300 card-shadow hover-scale" onclick="callPythonFunction('startAIPractice')">
                        <span class="text-2xl mb-2">ğŸ¤–</span>
                        <span>AIç»ƒä¹ </span>
                    </button>
                    <button class="bg-gray-400 hover:bg-gray-500 text-white font-semibold py-4 rounded-xl flex flex-col items-center justify-center transition duration-300 card-shadow hover-scale" onclick="callPythonFunction('manageKnowledge')">
                        <span class="text-2xl mb-2">ğŸ“</span>
                        <span>çŸ¥è¯†ç®¡ç†</span>
                    </button>
                </div>
            </div>
            
            <!-- æœ€è¿‘æ´»åŠ¨ -->
            <div>
                <h3 class="text-xl font-semibold text-text-dark-brown mb-4">æœ€è¿‘æ´»åŠ¨</h3>
                <div class="bg-white p-6 rounded-xl card-shadow" id="recentActivities">
                    <!-- æ´»åŠ¨åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </main>
    </div>

    <script>
        let bridge;
        
        // åˆå§‹åŒ–Webé€šé“
        new QWebChannel(qt.webChannelTransport, function(channel) {
            bridge = channel.objects.bridge;
            console.log('ğŸ• Pythonæ¡¥æ¢è¿æ¥æˆåŠŸï¼');
            initializeApp();
        });
        
        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            updateCurrentDate();
            loadNavigation();
            loadStats();
            loadRecentActivities();
            
            setInterval(updateCurrentDate, 60000);
        }
        
        // æ›´æ–°å½“å‰æ—¥æœŸ
        function updateCurrentDate() {
            const now = new Date();
            const dateStr = `ä»Šå¤©: ${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;
            document.getElementById('currentDate').textContent = dateStr;
        }
        
        // åŠ è½½å¯¼èˆª
        function loadNavigation() {
            const navItems = [
                {name: 'å·¥ä½œå°', icon: 'ğŸ ', page: 'dashboard', active: true},
                {name: 'ç¬”è®°æœ¬', icon: 'ğŸ“', page: 'notebook', active: false},
                {name: 'å½•éŸ³å®¤', icon: 'ğŸ™ï¸', page: 'recording', active: false},
                {name: 'AIä¼™ä¼´', icon: 'ğŸ¤–', page: 'ai', active: false},
                {name: 'çŸ¥è¯†åº“', icon: 'ğŸ“š', page: 'knowledge', active: false},
                {name: 'å­¦ä¹ æŠ¥å‘Š', icon: 'ğŸ“Š', page: 'report', active: false},
                {name: 'è®¾ç½®', icon: 'âš™ï¸', page: 'settings', active: false}
            ];
            
            const nav = document.getElementById('navigation');
            nav.innerHTML = navItems.map(item => `
                <a class="nav-item flex items-center px-4 py-2.5 rounded-lg cursor-pointer hover-scale ${item.active ? 'bg-primary text-white card-shadow' : 'text-text-gray hover:bg-bg-light-gray'}" 
                   onclick="switchPage('${item.page}', this)">
                    <span class="mr-3 text-lg">${item.icon}</span>
                    <span>${item.name}</span>
                </a>
            `).join('');
        }
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStats() {
            if (bridge && bridge.getStats) {
                bridge.getStats(function(result) {
                    const stats = JSON.parse(result);
                    const statsContainer = document.getElementById('statsCards');
                    
                    const statsData = [
                        {title: 'ä»Šæ—¥ç¬”è®°', value: stats.notes.count, unit: stats.notes.unit, color: 'primary', bgColor: 'bg-bg-light-green', icon: 'ğŸ“š'},
                        {title: 'ç»ƒä¹ å®Œæˆ', value: stats.exercises.count, unit: stats.exercises.unit, color: 'warning', bgColor: 'bg-orange-100', icon: 'âœ…'},
                        {title: 'æ–°å¢çŸ¥è¯†ç‚¹', value: stats.knowledge.count, unit: stats.knowledge.unit, color: 'pink-500', bgColor: 'bg-pink-100', icon: 'ğŸ’¡'},
                        {title: 'å­¦ä¹ æ—¶é•¿', value: stats.time.count, unit: stats.time.unit, color: 'danger', bgColor: 'bg-red-100', icon: 'â°'}
                    ];
                    
                    statsContainer.innerHTML = statsData.map(stat => `
                        <div class="bg-white p-6 rounded-xl card-shadow hover-scale cursor-pointer">
                            <div class="flex items-start">
                                <div class="p-3 rounded-lg ${stat.bgColor} mr-4">
                                    <span class="text-xl">${stat.icon}</span>
                                </div>
                                <div>
                                    <p class="text-sm text-text-gray mb-1">${stat.title}</p>
                                    <p class="text-3xl font-bold text-${stat.color}">${stat.value} <span class="text-base font-normal text-text-medium-brown">${stat.unit}</span></p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                });
            }
        }
        
        // åŠ è½½æœ€è¿‘æ´»åŠ¨
        function loadRecentActivities() {
            if (bridge && bridge.getRecentActivities) {
                bridge.getRecentActivities(function(result) {
                    const activities = JSON.parse(result);
                    const container = document.getElementById('recentActivities');
                    
                    container.innerHTML = activities.map(activity => `
                        <div class="flex justify-between items-center hover:bg-gray-50 p-2 rounded-lg cursor-pointer hover-scale mb-4">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-${activity.color}-100 flex items-center justify-center mr-4">
                                    <span class="text-sm">${getActivityIcon(activity.icon)}</span>
                                </div>
                                <p class="text-text-medium-brown">${activity.text}</p>
                            </div>
                            <span class="text-sm text-text-gray bg-bg-light-gray px-2 py-1 rounded-md">${activity.time}</span>
                        </div>
                    `).join('');
                });
            }
        }
        
        // è·å–æ´»åŠ¨å›¾æ ‡
        function getActivityIcon(iconType) {
            const icons = {
                'done': 'âœ…',
                'edit': 'âœï¸',
                'add': 'â•',
                'mic': 'ğŸ™ï¸'
            };
            return icons[iconType] || 'ğŸ“';
        }
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(page, element) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white', 'card-shadow');
                item.classList.add('text-text-gray');
            });
            
            element.classList.add('bg-primary', 'text-white', 'card-shadow');
            element.classList.remove('text-text-gray');
            
            if (bridge && bridge.switchPage) {
                bridge.switchPage(page);
            }
        }
        
        // è°ƒç”¨Pythonå‡½æ•°
        function callPythonFunction(functionName) {
            if (bridge && bridge[functionName]) {
                bridge[functionName](function(result) {
                    console.log(`Pythonè¿”å›: ${result}`);
                    showNotification(result);
                });
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            // åˆ›å»ºç®€å•çš„é€šçŸ¥
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-primary text-white px-4 py-2 rounded-lg card-shadow z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // çª—å£æ‹–æ‹½åŠŸèƒ½
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        
        function startWindowDrag(event) {
            if (event.button === 0) { // å·¦é”®
                isDragging = true;
                dragStartX = event.screenX;
                dragStartY = event.screenY;
                
                console.log('å¼€å§‹æ‹–æ‹½:', event.screenX, event.screenY);
                
                if (bridge && bridge.startDrag) {
                    bridge.startDrag(event.screenX, event.screenY);
                }
                
                event.preventDefault();
                event.stopPropagation();
            }
        }
        
        
        // å…¨å±€é¼ æ ‡äº‹ä»¶ç›‘å¬
        document.addEventListener('mouseup', function(event) {
            if (isDragging) {
                isDragging = false;
                console.log('ç»“æŸæ‹–æ‹½');
                event.preventDefault();
            }
        });
        
        document.addEventListener('mousemove', function(event) {
            if (isDragging) {
                console.log('æ‹–æ‹½ç§»åŠ¨:', event.screenX, event.screenY);
                
                if (bridge && bridge.dragWindow) {
                    bridge.dragWindow(event.screenX, event.screenY);
                }
                event.preventDefault();
            }
        });
        
        // é˜²æ­¢æ‹–æ‹½æ—¶é€‰ä¸­æ–‡æœ¬
        document.addEventListener('selectstart', function(event) {
            if (isDragging) {
                event.preventDefault();
            }
        });
        
        // é˜²æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
        document.addEventListener('dragstart', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>